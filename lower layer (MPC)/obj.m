function y=obj(u,N,Np,i,T0,H0,C0,RH0)

    %% RIFERIMENTI PER LO STATO DALL'UPPER LAYER
    %facciamo partire l'upper layer e salviamo i dati, che vengono
    %ricopiati qui
    T_open=[20,19.5440601100944,19.3434943601421,19.1274723392703,18.9224075180399,18.7284630841466,18.5548609251749,18.3907634038378,18.2340610260434,18.0934770115324,17.9679006775818,17.8507858403769,17.7631207232941,17.6750532405741,17.5973450157344,17.5374944996318,17.4838978134066,17.4516628398181,17.4208681948018,17.3897121559239,17.3614208050456,17.3520002805031,17.3097814000914,17.2560704375313,17.2256775398850,17.2231705743964,17.2360747101416,17.2622279370147,17.2689382527430,17.2694087356749,17.2567249686107,17.2414007298053,17.1934882113646,17.1136168959662,17.0332510349773,16.9020611658533,16.8416302537855,16.7750962823849,16.6973329826128,16.6484225407130,16.6004311491404,16.5433247957797,16.4804452169785,16.4418747151029,16.4199962297662,16.4000279405571,16.3686013436689,16.3252251149354,16.2750759618266,16.2485451643462,16.2862265490833,16.3374797017087,16.3775950822515,16.3941464407225,16.3616678470361,16.2979441311942,16.2464944131325,16.2010993443940,16.1719412721579,16.1338255805424,16.0700679924476,15.9936307443027,15.9406620949753,16.0409138134174,16.4264033366650,16.8854939600996,17.3634381917092,17.8439215420875,18.5207177569312,19.4833811059932,20.7019565438046,21.1890237947565,21.1440769216710,19.8615347604581,18.2468597826865,16.8460585103746,15.6423593321606,14.6084452542037,14.0013351651243,14.0005827428703,14.0002368337267,14.0003279129299,14.0001657337261,14.0001593126421,14.0002331999914,14.0002466972410,14.0002665404578,14.0003072933953,14.0002293239402,14.0002298658526,14.0002351353517,14.0009867784165,14.0000292015671,14.0298994417168,14.1723075352122,14.4769473034182,14.9378310987738,15.4252968092696,15.9496199325846,16.4931936688805,17.0834917971213,17.6376129846844,18.2311101528654,18.7122776658179,19.2782909256982,19.9114033528672,20.6334257727146,21.3496793442139,22.0414179744732,22.6995478520729,23.5574915560362,24.3738594291434,25.2444584783795,25.9066867675108,25.9384443414628,25.9558625640334,25.9619175035252,25.7266059312631,25.9535688481368,25.9493535464819,25.9678511495692,25.9429546010313,25.9446992304794,25.9668503450359,25.9570857067447,25.9694457149716,25.8328519788096,25.9838390817847,25.5490580985682,25.9802243998543,25.7692694042263,25.9599380238020,25.9660774503516,25.9333474445645,25.5768809411500,24.8044621986805,24.3448028945324,24.1821001141251,24.0605718869031,23.9534555227423,23.9331558497591,24.1050317861672,24.3270547462703,25.1257541840712,25.9998701384607,25.6187277122877,25.1310786326904,24.6520891165224,24.7551712641376,25.1626651246585,25.9164483827922,25.8607891247128,25.1456982613886,25.2081289560929,25.3918708255709,25.9944452650035,25.7205725316088,25.6834708502250,25.9215271687773,25.7039852543861,24.9350090916069,23.6450845678395,22.0816412613675,20.8625669830229,20.7961696178608,22.4913293833465,23.9903419351852,25.1867288636197,25.6210434438021,25.7776050287670,25.9998216507980,25.9412470039030,25.9823852823898,25.9512086234898,25.7667986931294,25.9935878181329,25.9802383791895,25.8391885468018,25.9899178341963,25.8885935088675,25.9785694487272,25.9721637036279,25.9282224436437,25.9802440867417,25.8826732605750,25.9832611487476,25.9236621856173,25.9798098615557,25.8953387564422,25.9553911874603,25.9768286583550,25.9355225102590,25.9531737577732,25.7903918991545,25.7852887326540,25.9016943774320,25.9456694748546,25.9088197236318,25.6928981192619,25.0527018194723,23.9686926798692,22.6067528859758,21.4029732988815,20.3978465757891,19.5893474784614,19.0471145388599,18.7210906609554,18.5121614991734,18.3603093129602,18.1950746982135,18.0180996718231,17.8548960947851,17.6976230342070,17.5539766547921,17.4101621755570,17.2530973611532,17.0864445843484,17.7866115673463,18.3680110294379,18.8727253474111,19.2893878240016,19.6319661550330,19.9102094400859,20.1346313029631,20.3299637535657,20.4800291185743,20.5681732467290,20.6390296683384,20.7107951604379,20.7569310208050,20.7700355613331,20.7796267730796,20.7703150360092,20.7466095696377,20.7081891875664,20.6708561251692,20.6399745688805,20.6047948363420,20.5357978539999,20.5579713149185,20.5383896527150,20.5000968703844,20.4131322399463,20.3481231280329,20.2488918920160,20.1406225200543,20.0546332041592,20.0087545059435,19.9934558469137,20.0202068369836,20.0786213532881,20.1527167989885,20.2121430519705,20.2556236665394,20.2824432129091,20.2861310141331,20.2662337973736,20.1936496154901,20.1003520920779,20.0011229948704,19.9079144565242,19.8339013235357,19.7580351244035,19.7323760520988,19.7662699342479,19.7646728779163,19.7590905375626,19.7376898020217,19.7639624201814,19.8068458600001,19.8239301626083,19.7459962480927,19.6489601577837,19.7013437293643,19.7380484428766,19.7142795210100,19.6831530639337,19.6489214919172,19.6084962631447,19.5494449713394,19.5092916550637,19.4589101612463,19.4064136259767,19.3524809960391,19.2859967979231,19.2182512770231,19.1684488858198,19.1297860906213,19.0754777951175];
    RH_open=0.01*[74.4284465895943,84.7160487232913,89.9492722771278,89.9127673497821,89.9070618816627,89.9030198914139,89.8961054585197,89.8903861156314,89.8837007614858,89.8698204197776,89.8579717493614,89.8349079821208,89.7973035727421,89.7007885739550,89.6001832961332,89.5875773264829,89.4231065604520,89.6557966655130,89.5791409571472,89.6038505875265,89.5648129836263,89.5858986669740,89.5602893428158,89.5657907456313,89.6090131571824,89.5945514988500,89.5930537799431,89.5801158960050,89.5857990763627,89.6130999142301,89.6023690603856,89.6117196908340,89.6265810123157,89.6180532047334,89.6006548967804,88.9903889271144,89.7150161438237,89.7327479696760,89.6973197674015,89.7363331203281,89.6877552213955,89.7033661812293,89.7403628276551,89.7718488745319,89.7389673186151,89.8094033649929,89.7788630501205,89.7952705770946,89.8463758858165,89.8809981959569,89.8770230118452,89.8983889800689,89.8719207596403,89.9284445192271,89.9372908409123,89.9300642214623,89.9561535240829,89.9582857076532,89.9652897716641,89.9729696168052,89.9788531089280,89.9867196128556,89.9925349599230,89.9939668972764,89.9867969020715,89.9936208386470,89.9977689639273,89.9980789208577,88.7052575828623,85.7958890267107,82.1384388230742,82.5608601720627,85.0454564256979,89.9990571634382,89.9989579893237,89.9981456959988,89.9988487123784,89.9987428470536,89.9987789782406,89.9953182942472,89.9976998116732,89.9987130092359,89.9983119266573,89.9992532121509,89.9984641531731,89.9992914211899,89.9992892839841,89.9982191631947,89.9991836100731,89.9990567833073,89.9990638775965,89.9990223366320,89.9992964115273,89.9485588356507,89.9145141553780,89.9636766722472,89.9266243696927,89.9580983290807,89.9647390678979,89.9510800701987,89.9518624778722,89.9291168219405,89.9403756269089,89.9255002597351,89.9409263526777,89.9372143758230,89.9340517378489,89.9410404364157,89.9511511692204,87.9367894690658,89.6119632852888,89.5644007658297,89.3717117317858,86.0473455342442,75.8014079694587,74.6168639789815,73.7971413802162,69.8478329949649,73.5639979123559,70.0713610468916,69.8046206228637,68.9666732488640,68.6012993883955,66.4780147378605,66.0125107539447,64.2693487412688,62.4019079330894,64.8390942034143,68.1857525086343,74.3558342819807,72.2857831250118,66.5112679301765,64.6522354510671,63.1990587277933,59.8160525871548,58.0552917377287,60.4072195533958,61.8640153726681,61.2613395977015,62.9586489514025,61.3595816354746,61.8385017177706,61.7442941409365,63.3244464575891,60.8787699705286,60.5644798553309,64.2504857184752,70.4874423705006,78.3268280047990,83.6556032758176,84.1699828278787,77.3432597092506,67.0200763688231,61.6751838193114,59.5143740459494,63.3272574397201,65.9346377809503,72.9487281421423,79.9149322586028,81.1609596244762,73.4537436248151,63.7546753914717,58.7207195343186,58.8473108317802,61.5801100379911,65.9531997026327,59.9910223778398,56.3279238078956,55.8068703226503,52.8209541865442,52.8246762804364,56.9944922018211,56.9058609990756,55.3296523052957,51.9665675421793,53.3621914598496,55.6662084021742,57.0545978468888,60.4107499532663,55.7144900173758,59.5351664353215,59.8330832208736,57.9545699344931,59.4263860147101,55.2980416555310,59.7853128776048,58.9045776039696,63.8228460384264,63.1488615997864,63.9487763562721,68.6464848859007,69.0729646828922,73.6418860266189,72.3947086143635,79.3891422928318,83.9485608196096,86.4564522702860,87.9811954379525,83.2258695341458,71.5709593366889,60.6014145639421,60.0508425310636,65.8629571769090,64.1294183075236,70.7678833140490,79.4096960526087,85.2249539511962,89.2406319530066,89.7339625518617,89.6850171391505,89.8566498506614,89.7477331831102,89.7198501705729,89.7431482066108,89.8126498963409,89.8673296942792,89.8604276317977,89.9311673013676,89.8838088688426,89.9100088300033,89.8994236450802,89.8978711454290,89.9019548300730,89.9087252664384,89.9101811036465,89.9021869043272,89.9084061583397,89.9073846666936,89.9346765316765,89.7720874739958,89.7642045575351,89.7787012301600,89.7756160352556,89.7835021994562,89.7768571479934,89.7828104506618,89.7829732085433,89.7705475555635,89.7803536211076,89.7795016686864,89.7213701956941,89.7911161571910,89.7656803832456,89.7699593722617,89.7771472215410,89.7814692459772,89.7673043941314,89.7878972649034,89.7511783961963,89.7679257064389,89.7657037671887,89.7413029040303,89.7546628022221,89.7731645121527,89.7481867293307,89.7538925306678,89.7661731829438,89.7674871367192,89.7564081380050,89.7816784477631,89.7600904000394,89.7532335041686,89.7543704456293,89.7012028968891,89.7802068082316,89.3251150131685,89.3398223578411,89.3469486379717,89.2827637613944,89.2815197134829,89.2965613859818,89.3291738938815,89.2945899781552,89.2761428903518,89.2464756282357,89.3194334378695,89.3234823268486,89.3267979689801,89.3506812832498,89.3742884177390,89.4001239700674,89.4326467143888,89.3622356059509,89.3224047849582,89.3769219471877,89.2632264454750,89.2828212922039,89.3618639236934,89.6266050766219];
    C_open=[500,494.055835897947,487.156902383528,474.174153354679,462.406344130727,451.725087180910,442.049961683394,433.279081577737,425.346629038368,418.185322162683,411.722290149856,406.012661213738,401.336706180449,400.551482920184,400.710533531301,400.651762937393,400.939473238902,400.823917685345,400.820174123711,400.821763103886,400.829494542918,400.836093764973,400.835994015833,400.853408726181,400.851597660600,400.859424089506,400.863886191604,400.875968620347,400.859011712637,400.871115518582,400.870678953321,400.857758171570,400.835885866847,400.771801391545,400.559217046402,401.599290255555,401.049920908910,401.015255126847,400.992529498556,400.961704269835,400.964221556034,400.985775376424,400.972211880336,400.951690334185,400.987968667654,400.928775056226,400.947435309168,401.133938672086,401.062586365280,401.043353232917,401.040465512506,400.971015431024,401.172570617803,401.110956434289,401.044702852620,401.160824649637,401.138741906204,401.142995355302,401.202294430175,401.287557713619,401.383855727018,401.476275834291,401.988466849593,404.977098035609,408.702831638836,411.110643288335,411.994433087072,412.021452892335,411.174649277595,409.717527610877,407.538108452637,404.515425735529,400.497077182287,400.696563288793,401.625317204877,402.500669017845,403.330718196869,404.141890218997,404.858330680258,405.333828153279,405.770123019849,406.172362587863,406.550831035179,406.908175960990,407.165629348641,407.277347036962,407.195760517759,406.849686461198,406.182898802181,405.197775037710,403.930462619830,402.516653660213,401.502067900979,401.421186957487,401.684713678372,401.798905796350,401.874324449849,401.749209505338,401.567762569906,401.464145161438,401.249070132542,401.180566855616,401.030688033421,401.042646335157,401.069859260731,401.133952529306,401.141457017943,401.238277135625,400.572411554710,403.814851341445,402.595939332239,403.008234228766,401.584388313367,400.477062523765,400.519178193111,400.558881405077,400.366018154176,400.801102877678,400.415339196868,400.435947152674,400.392026591071,400.383326518010,400.338659517826,400.316184718022,400.285540058398,400.264700318519,400.254434292329,400.482380059373,400.738419573872,400.503503620991,400.258102418190,400.319763925963,400.202983049286,400.212892547710,400.167859953937,400.182846825034,400.179603168261,400.180647259891,400.180291689700,400.179474164070,400.179231213847,400.180733525398,400.183817802258,400.190735552774,400.260599593554,400.419957338386,400.963820255501,400.577855783743,402.575665307142,400.745260863419,400.740161888119,400.387509368463,400.283210890459,400.185422582909,400.229987445483,400.410385743978,401.141132824786,403.554628633499,401.391686667963,400.395316518261,400.248615218587,400.095917655529,400.195451438762,400.067094424003,400.107279212337,400.185701430279,400.182991778984,400.180683099153,400.177786916240,400.175166057387,400.201703026839,400.190276484432,400.175937594582,400.166866507836,400.186609995420,400.222403445492,400.181408529484,400.330242650757,400.162340588306,400.343338467875,400.196472315743,400.166489459524,400.359374413188,400.149536225476,400.333481256791,400.131641696118,400.459475075163,400.364406298703,400.191219592083,400.524132794025,400.410449723141,400.493330698005,400.349163306658,404.219541661838,404.066941397052,402.838251280997,401.943996795021,400.903083398571,400.414275137651,400.078927955086,400.414721192193,401.802103560974,402.651018008663,403.897721314511,404.123510483871,403.821820102615,403.532010833985,403.293785837802,403.423493515865,403.712565245408,404.064988904492,404.432431629738,404.794318174208,405.170889138883,405.574301930694,406.159138002727,407.013448863574,402.686082109954,401.219972760982,401.167296218344,401.112026845355,401.048697720286,401.013787365284,401.071501914798,401.057870209227,401.070738184403,401.047248803081,401.078470738033,400.923055979681,401.030396892858,401.055195748639,401.049292001204,401.051209159903,401.045841965155,401.046258196298,401.052667317668,401.052413125919,401.024011277694,401.062483297904,401.012499293905,401.122491581527,401.052873919015,401.057380583936,401.030882994449,401.030200969354,401.034038641184,401.041730473023,401.055923688761,401.074165594605,401.112743298223,401.100490968169,401.105612020784,401.120694205932,401.119731596678,401.113916829601,401.112937342167,401.087231166156,401.062353021655,401.082277462230,401.035127023694,400.975373147462,400.927782105805,400.859245960200,400.926048481681,400.731606538124,400.765959739041,400.758724642151,400.725194240799,400.745936953693,400.769313121499,400.731110348486,400.728044078174,400.761586896895,400.747645803005,400.787936558074,400.835633250472,400.867284419815,400.920234243814,400.969151203515,401.011535920395,401.013375143121,400.998838231589,400.968230950160,400.953497780656,400.874066285237,400.942895274128,401.034892902224,401.023961659723,400.158578963281];
    C_open=C_open*10^-6*1977;
    
    % per la durata dell'orizzonte di predizione, consideriamo i
    % riferimenti costanti
    T_open=repelem(T_open,5);
    RH_open=repelem(RH_open,5);
    C_open=repelem(C_open,5);
    
    %voglio che ad ogni iterazione il riferimento sia T_open dall'istante successivo fino all'orizzonte di previsione
    Tref=T_open(i+1:i+Np);
    RHref=RH_open(i+1:i+Np);
    Cref=C_open(i+1:i+Np);

    %% RIFERIMENTI PER L'INGRESSO DI CONTROLLO DALL'UPPER LAYER
    %facciamo partire l'upper layer e salviamo i dati, che vengono
    %ricopiati qui
    u1_ref=[31.2803738831016	30.5437431846941	28.7734922067894	-4.09037160933494	-3.09964381301892	-0.122875364609178	5.38394276502510	0.00381304977994990	-0.587635410380900	-0.483525206024786	0.593119359491901	-0.00484469939259858	-0.998405656276383	-2.18010200549976	-0.0787412537961822	21.2011291304167	1.59019986351542	-1.85658365066236	-1.47963177719471	-3.25563590464246	2.27843236625797	0.733661140412239	0.311584841316047	-0.866438074402667	0.0898406344586425	0.909949118893991	-0.0967319754960399	-1.82148490889455	-1.24346544039916	-3.35948170933957	2.10882111163057	0.292999738817884	-4.09719408229240	2.66549707553424	0.782505596727209	-1.82455413176684	-2.31268690830206	0.225728601868422	2.11522732117869	-1.82676048098122	0.858260476888187	0.716733789664603	0.130506223824169	-11.8309726894990	-0.465126482385968	0.637240535076402	2.74149650092597	-1.11638006832766	5.77195292697134	-0.337147506996734	0.533375549094996	-0.378296113385707	0.817661028289349	0.732394817745272	18.2620640425101	24.2847354773650	27.5016830142375	42.4614979012452	41.8107216981142	44.1739652957186	60.1174979968286	56.8961070471483	66.3798948949149	24.1438220507969	43.2151099322775	62.1996023310941	78.5303225959438	117.204663260609	149.038797245975	150.309309956637	99.3715806037717	69.3469123022068	18.3594537441511	18.7580521718121	69.7446198494841	22.8573988221577	52.5345835484563	1.57581613249596	52.5655850704726	74.0508677318759	74.5527530030752	74.5757883674977	73.6889058648283	98.8091424465438	47.9152858918465	70.2093894177208	46.9916746307548	40.9134927673715	31.5206303919211	23.4718655509798	8.59022961535002	3.43384435927678	1.85455588175948	-1.27131835986927	1.11489496536175	0.135403657961241	-0.298720333930580	-0.479268166059010	0.605512204030109	1.13849317494586	0.152170749337754	-0.642670657423500	-1.27536873667546	1.07363972473362	-1.04946897484908	-0.532092075093636	1.65780714564698	0.132125396972462	-0.992442424979037	-0.514468393234209	-0.376489361851057	-0.968063071129383	0.603803256978197	0.122724056597689	0.482779970283662	0.329288878109037	0.183697845016621	-0.179908927695456	-0.435574546064527	-1.42675068441845	-20.1040283798813	-71.0736450674995	-55.6176047620274	-5.67946223906428	-4.05135566146368	-3.78260704345813	-0.806690325272280	1.87252102737929	3.16105314091617	-5.77298827104183	0.700024376973506	-5.10240571728095	0.573803624811730	-0.620385238097512	-0.640362486802849	-2.94028908652203	-0.732598014862899	-0.565354705324113	0.197001447979966	-1.59506389242100	-0.184500200132508	-0.192524239259470	-0.735186529377881	0.260996400729836	-4.45262233228057	0.330085408895028	-2.09694179345497	-1.08035475108115	-0.572530636570689	-5.26766498347703	-0.489320655512952	-1.60351638158394	-0.283340231117227	-1.10099523330780	-0.728732471372594	-4.15559954558820	-8.00741965145593	-3.74997599121053	2.03611092220095	-0.534806537700190	-0.479319579704583	-0.652661662140653	-0.852082028419190	-4.02067355868629	-5.98050025812950	-2.36136350647988	-0.00283038136393522	1.94557993233528	-4.04072969689469	-0.0213912481125505	-2.67794991199679	-0.494529162210673	-0.923894530335833	-3.04670419356163	0.678865480485797	-0.313380501615070	-2.66839792689174	0.0385273656605827	0.0906728503432209	-2.73957468519888	-2.81116204305207	-4.60461723971662	-4.78377477592940	-1.54837544653639	-36.4560083828383	-36.0305439309668	-0.686312878232079	-2.74086967667947	-2.51462579333549	-1.82650827856767	0.274994000198797	1.14459142964911	0.635312950640053	-1.34590694109490	-1.14695592678862	-0.101740580976846	-0.321893126211251	-1.71567102023947	0.160012169678123	0.528740926451130	0.196230991677291	0.247368338260891	0.00880543798597944	-0.628474651521444	-0.485535196434312	0.924648758812640	-0.226101054158350	-0.546824966629843	-0.241956849263167	-1.45335018325847	-3.82532324820396	-0.0349348339772053	1.66226130138966	-0.768625371494561	-1.21081174092792	0.409063185074538	-0.326075995938176	0.145755822831393	-0.169331838165993	0.416649869258685	0.572495620593663	-7.81024481543135	-8.24877834995241	-8.60736635747799	-8.81103786365364	-8.90829600099896	-7.75283204784865	-7.24911891866564	-0.195789178546262	-0.227180397449029	-0.652425057085855	-0.348429620356226	-0.629882363489226	-0.303561143002901	-0.348525795586287	-0.601844619321414	-0.435649836938755	-0.0534424599593098	-0.215266167022776	-0.500605183128521	-0.0927223883407666	-0.230305457487884	-0.276005202544913	-0.168830936753990	-0.533233384660014	-0.525965108761656	-0.284315977317304	-0.220769046058503	-0.508102834235076	-0.498459186763257	-0.178414696748635	-0.285493317316903	-0.333147966539166	-0.110792883413067	-0.551716052805757	-0.417233681649266	-0.145606478841926	-0.377784736787399	-0.0962929389361310	-0.219921618997597	0.0715150860856058	-0.479147754900833	-1.91099377325218	-0.994657424997040	-1.66998350353439	-0.943529564523362	-1.66500218970058	-1.06789972656100	-7.32755578864801	-1.50422322875962	-0.803236028773234	-5.36079311174810	-1.02142695346032	-5.31126370551322	-5.28301060994599	-5.33175188620259	-5.29737229107907	-1.55831304521923	-0.956273132442072	-7.46087049069142	-1.00194235238839	-1.02166624260569	-0.983993595526378	-7.37594762942845	-0.362098974217141	-0.540934611510642	-5.13044206605597	-0.334665776610669];
    u2_ref=[0.000189535813747041	0.000408941176889195	0.000851160995245366	0.00295734207853845	0.00301197401955444	0.00279607624305056	0.00238915283832313	0.00265901214665979	0.00262278880276564	0.00253800161687957	0.00244300286865328	0.00241442811449046	0.00241033155491523	0.00243254683731483	0.00223548181386232	0.000982214196154453	0.00218210376018818	0.00236116220668896	0.00228309187195090	0.00232631462563407	0.00195778468621139	0.00202668295443813	0.00203936794753315	0.00208396450828596	0.00200684003895983	0.00193456274863361	0.00198296664745893	0.00205916297343497	0.00199225968488390	0.00208174755166709	0.00172726036246226	0.00184516903099677	0.00209365794832271	0.00165658226503464	0.00177049626894276	0.00192441528867391	0.00192627696536275	0.00173366524351639	0.00160548004607314	0.00183338823136363	0.00164995755464857	0.00165581195016203	0.00166795896948305	0.00241476054087830	0.00160743568438314	0.00153221476484721	0.00140207004643807	0.00165114319283322	0.00117951336005366	0.00159499391882235	0.00151203664560453	0.00154593652400701	0.00143389783284076	0.00143129307740182	0.000289674885990783	6.19154864864701e-05	3.03812796093018e-05	1.85165381259601e-05	9.16591780753956e-06	1.12118811742958e-05	4.73268569624497e-06	4.74462414040455e-06	4.98309400716840e-06	1.03426922005855e-05	6.90612278038800e-06	1.55664939561656e-06	1.36595863491778e-06	1.29891255337182e-06	1.12714491445379e-06	1.13722702926943e-06	9.65506425868553e-07	1.08405347879017e-06	5.91460564436740e-07	0.00226908492002516	0.000123730081541743	0.00234384431555530	0.000884122302870404	0.00363386665318861	0.000671861123267074	2.06476856945583e-05	3.30030728224586e-05	3.13666116162301e-05	4.16155528838535e-05	4.15768708576036e-05	4.50717687294225e-05	5.78910357263103e-05	5.45833457409894e-05	5.38652604916967e-05	0.000253612974412682	0.00101173923834764	0.00163443274517634	0.00167751116617518	0.00151745208956082	0.00139816944823117	0.00115467054907400	0.00115688182527954	0.00123514441836534	0.00131290855739643	0.00143746685106137	0.00154920853638037	0.00166824480045318	0.00180519279923741	0.00191659871255967	0.00191095247740209	0.00203678059442852	0.00195948932024960	0.00175069624333158	0.00158691908841801	0.00167201575212740	0.00135375756735372	0.00128811490478525	0.00148953855803639	0.00237524279560102	0.00534723022179728	0.00491002444554743	0.00450170534515733	0.00494666770994573	0.00572599042594275	0.00622821464818724	0.00688760564298940	0.00386933178210789	0.00179880426128327	0.00427903845055590	0.00887815789474487	0.00886838993213172	0.00911219163062199	0.00880995151058206	0.00861239867534618	0.00811729413354369	0.00852670926798153	0.0104564390915062	0.00872308595151335	0.0101222567548579	0.0111502949101790	0.0108330967868461	0.0109137305827015	0.0111458851238234	0.0111643192248908	0.0125858257325621	0.0137301866581972	0.0124478306788602	0.0135594137501691	0.0134829012729495	0.0128779325558656	0.0129882943411556	0.0155909046568904	0.0135281311813491	0.0136975736928969	0.0131997125343877	0.0113450422894900	0.0144912105053142	0.0142247351156357	0.0139802819260732	0.0150567556295561	0.0134698352104226	0.0139917601852032	0.0148553776881779	0.0155523746065694	0.0145604232902527	0.0154427722085239	0.0144292581327236	0.0145179624581089	0.0131255687500231	0.0137738087447414	0.0134897152471013	0.0133240474611662	0.0127935513353908	0.0125394891859712	0.0125672871844231	0.0113111249273843	0.0134434634092357	0.0131531988130714	0.0130319590519513	0.0121946851088655	0.0117762344185293	0.0104291288236995	0.00992123400427351	0.0109943855848830	0.00953808945597806	0.00939912214499603	0.00929517984773484	0.00878486051402319	0.00799534136368349	0.00686922548582776	0.00212465567962328	0.00355294130843987	0.00743558968740713	0.00436389719822191	0.00448718327194560	0.00315844820883444	0.00332850382330059	0.00238579040480734	0.00161017728746334	0.00126607888686166	0.00102435995520546	0.000937491028148171	0.000973814742228742	0.00116691843784596	0.00138017888756426	0.00159149467323479	0.00182614370103308	0.00203370459384633	0.00229464395839814	0.00626293493734451	0.000578141442272079	0.00261067435923635	0.00302533182321232	0.00317525982719932	0.00331137106395427	0.00344154748098280	0.00367524625494880	0.00337019978616208	0.00335910049473458	0.00343515802504060	0.00342497583104445	0.00327461039370576	0.00133772709712642	0.00184590938700071	0.00219533265052216	0.00236906049192329	0.00251335555774564	0.00299661283743910	0.00305351379038428	0.00310260558597912	0.00313920677540268	0.00315960860708716	0.00316081906288104	0.00312216103540574	0.00319384041628151	0.00307108434112960	0.00309144708260284	0.00305174026428058	0.00305223027711576	0.00306373986114631	0.00310606036008224	0.00317046352105924	0.00317666027334217	0.00317120586032334	0.00315973472389866	0.00315108765820534	0.00311083289214925	0.00311165691071131	0.00312197039745859	0.00310759775683031	0.00312055365775657	0.00311141897229342	0.00309632505365454	0.00310096935918572	0.00310973146277092	0.00311292719265256	0.00310060598840300	0.00310902819291047	0.00312690648359060	0.00312251454790010	0.00315840025462221	0.00315772705965010	0.00315051789857676	0.00316121092214439	0.00314488512905503	0.00315930677995545	0.00315665042145002	0.00319684073818843	0.00326615399851898	0.00310509128444537	0.00343701817207090	0.00329683641534764	0.00332690202833036	0.00330262137176278	0.00366027976474002	0.00335145460491264	0.00331148735783036	0.00354538993883561	0.00330551014380442	0.00355891938622050	0.00355531455203632	0.00354297679943409	0.00353413223220468	0.00329605003184503	0.00325186953495892	0.00361331887440032	0.00325700807663144	0.00326959869351986	0.00330891573324440	0.00370163385764526	0.00326825636145830	0.00327564801451900	0.00353307798038828	0.00298220620347353];
    u3_ref=[0.000218672970169200	0.000224036831581015	0.000229284188090188	0.000237865187014696	0.000246862937357685	0.000255556328421878	0.000263128457194323	0.000270506713277174	0.000278051512136656	0.000284658301526864	0.000291115099622359	0.000297737839054418	0.000303647116955790	0.000310848386422229	0.000315780612684899	0.000310377110838884	0.000315073494714501	0.000319435539485150	0.000322863826707518	0.000326435726919767	0.000328468123654417	0.000329648850158673	0.000330953420130887	0.000331775727117020	0.000333580861974725	0.000334551569034643	0.000335063106879511	0.000336244744203457	0.000336080841403341	0.000336939174960153	0.000336405828997352	0.000337829799821547	0.000338381391646611	0.000337994267113951	0.000338028479448676	0.000338549035386312	0.000338630601982595	0.000337616549681955	0.000335784401268014	0.000337214505943705	0.000337063278699519	0.000336766488359315	0.000336828218279922	0.000348552636155173	0.000347407314819716	0.000347191318338092	0.000345479645352370	0.000347112317979791	0.000341698309202855	0.000342198847739839	0.000342375808305769	0.000341717975815790	0.000341769397131086	0.000342189960431419	0.000331631778227774	0.000321379012586345	0.000312276729328508	0.000304482700890398	0.000297700621028224	0.000291720535618107	0.000286751890159595	0.000283828651862386	0.000281628564211988	0.000279781025731856	0.000277714942145167	0.000275679260593250	0.000273503122337630	0.000271622128157045	0.000270554516127180	0.000270357258436453	0.000269803572594618	0.000269354014040873	0.000263359407405277	0.000266511592174333	0.000260691852727596	0.000263852135709263	0.000265728349326494	0.000276393346546148	0.000279069320284424	0.000280714552448699	0.000282674215881609	0.000282580398679172	0.000281372180666458	0.000281210125912289	0.000282089839013164	0.000282959215386019	0.000282960793644682	0.000282582429063215	0.000281325697444831	0.000281938092574978	0.000284829666684378	0.000287009997413581	0.000287523024538153	0.000286406436615275	0.000285741463056758	0.000287299911269431	0.000289963176881936	0.000294964330072712	0.000303080514177585	0.000313755317141966	0.000324190627839530	0.000335440765028539	0.000348478499352030	0.000364874917898581	0.000384824280345435	0.000407041593639015	0.000428430878836206	0.000445198791515170	0.000464546778927333	0.000472637523525945	0.000475157531062920	0.000472843620498297	0.000476054560422164	0.000557243302910370	0.000644027218389565	0.000655536351947345	0.000659781679551711	0.000689558519631822	0.000720919491081675	0.000843597158593055	0.000795176614991061	0.000596059226127367	0.000608558535471249	0.000760867329672191	0.000790769118006761	0.000845224567059823	0.000850775888070016	0.000855641911711703	0.000837102149327857	0.000807560517980034	0.000900452818084542	0.000822707032270381	0.000826142818087403	0.000877188878561039	0.000876601611235764	0.000885108935889180	0.000872807730816536	0.000846280491862002	0.000863569471322973	0.000907327469807575	0.000865360054569575	0.000888023708972839	0.000899339881246531	0.000901443500250621	0.000851755004770554	0.000916794487059051	0.000898256145089669	0.000909443708966939	0.000915009501831412	0.000809903866670362	0.000889035520896181	0.000883667549652404	0.000850310396827875	0.000891389705678944	0.000841025528894751	0.000852170706741509	0.000858101876669801	0.000874089072896773	0.000846899623118318	0.000870647830939408	0.000833004679947117	0.000855552419341234	0.000813220153572843	0.000827401778739347	0.000844615038919502	0.000839862317370541	0.000822341519032710	0.000792816706375431	0.000823275744084049	0.000736658740585452	0.000774631417619856	0.000766701197883869	0.000764979461449220	0.000742794820635126	0.000744556381140558	0.000714824231073460	0.000694629343748786	0.000725349139114155	0.000681540232577492	0.000671996682749661	0.000678977185605548	0.000677459071523752	0.000697737122053327	0.000798896627221164	0.000532808943275019	0.000474092581628571	0.000599989430937660	0.000546212156144041	0.000554824417635825	0.000519277716259414	0.000501876541826333	0.000465399220618096	0.000424397255735187	0.000389570049170747	0.000359982758309035	0.000335575240230944	0.000315836579181909	0.000300081366032766	0.000287376950609862	0.000277041676641935	0.000268479870397562	0.000261557415909514	0.000256064694943965	0.000263093148243891	0.000254264573218862	0.000251782013901440	0.000250462180524195	0.000250010948770058	0.000250359981337427	0.000251813385885049	0.000254678212736700	0.000258223963819843	0.000262364541046434	0.000267727235596769	0.000273718316813588	0.000280523368823989	0.000280516432750824	0.000281429298893627	0.000283245448412157	0.000285637976420773	0.000288496523011626	0.000293753593299043	0.000299231932220482	0.000304800224313763	0.000310283763396717	0.000315496984970614	0.000320270345380789	0.000323596344776927	0.000327512798673250	0.000329233685649996	0.000330902345592446	0.000331768917485567	0.000332311966650663	0.000332686943267034	0.000333248616307421	0.000334226853108986	0.000334894954176568	0.000335602597017139	0.000336169248239012	0.000336591979607856	0.000336582827960178	0.000336564173502995	0.000336620471250130	0.000336571301624009	0.000336614032862014	0.000336575491610461	0.000336400668987206	0.000336228725432359	0.000336165652390010	0.000336108091308017	0.000335890189311308	0.000335748988504996	0.000335695314144554	0.000335606648965284	0.000335810419180271	0.000335973945196307	0.000336032158630856	0.000336157998783152	0.000336114769076062	0.000336158117441080	0.000336157931590292	0.000336171085269789	0.000336319153956090	0.000334521688592215	0.000336084779124902	0.000336501553728070	0.000336760710928433	0.000336397044659272	0.000337876592617620	0.000337485125914612	0.000337124726900844	0.000337977027266946	0.000337139929196035	0.000337641332787421	0.000337782561460909	0.000337480835430907	0.000336620670368375	0.000333793589591332	0.000330414976003219	0.000327720696085090	0.000322396426727230	0.000315989892581492	0.000309114255357947	0.000302054416320277	0.000291677961619904	0.000280209885542907	0.000268828265685939	0.000257381726884528];

    % per la durata dell'orizzonte di controllo, consideriamo i
    % riferimenti costanti
    u1_ref=repelem(u1_ref,5); 
    u2_ref=repelem(u2_ref,5);
    u3_ref=repelem(u3_ref,5);
    
    %creo il vettore U dei riferimenti
    U=[u1_ref;u2_ref;u3_ref];
    
    %andando a prendere i valori sulle colonne sto considerando gli istanti
    %successivi
    um=u+U(:,i:i+Np-1);

    [T,RH,C]=greenhousemodel(um,N,Np,i,T0,H0,C0,RH0); 
    
    %%CALCOLO ERRORI SULLO STATO
    T1=T-Tref;
    RH1=RH-RHref;
    C1=C-Cref;
    
    %??
    Tf=T1/12;
    RHf=RH1/0.25;
    Cf=C1/0.2;

    u1=u(1,:)/200;
    u2=u(2,:)/0.02;
    u3=u(3,:)/0.02;

    y=sum(100*Tf.^2+100*RHf.^2+100*Cf.^2+(1*u1).^2+(1*u2).^2+(1*u3).^2);%% Q ии la matrice di peso dello stato e vale [100 100 100], mentre R pesa l'ingresso ed ии [1 1 1]
end