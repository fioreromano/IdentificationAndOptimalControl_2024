function [T,RH,C]=greenhousemodel(U,N,Np,i,T0,H0,C0,RH0)

U1=U(1,:);
U2=U(2,:);          
U3=U(3,:);       

          

T(i)=T0;
H(i)=H0;
C(i)=C0; 
RH(i)=RH0;


Ccap=30000;
kcov=10;
h=7;
ru=1.225;
Cair=1003;
LAI=2.6;
gamma=0.008;
rb=150;
L=2450;


Tout=[12.7100000000000	12.6200000000000	12.5700000000000	12.4000000000000	12.2400000000000	12.1600000000000	12.0200000000000	11.8700000000000	11.8000000000000	11.7300000000000	11.6400000000000	11.7200000000000	11.6400000000000	11.6400000000000	11.6700000000000	11.7000000000000	11.6900000000000	11.7000000000000	11.6400000000000	11.6400000000000	11.7300000000000	11.4700000000000	11.3200000000000	11.4200000000000	11.6100000000000	11.7300000000000	11.8500000000000	11.7300000000000	11.6800000000000	11.5900000000000	11.5400000000000	11.2500000000000	10.9400000000000	10.8300000000000	10.6100000000000	10.5500000000000	10.4800000000000	10.3100000000000	10.4000000000000	10.3500000000000	10.1900000000000	10.0400000000000	10.1200000000000	10.2200000000000	10.1700000000000	10.0600000000000	9.90000000000000	9.75000000000000	9.88000000000000	10.3700000000000	10.5200000000000	10.5100000000000	10.2700000000000	9.98000000000000	9.70000000000000	9.69000000000000	9.70000000000000	9.73000000000000	9.59000000000000	9.30000000000000	9.04000000000000	9.17000000000000	9.45000000000000	9.59000000000000	9.78000000000000	10.0300000000000	10.3000000000000	10.0900000000000	9.40000000000000	9.06000000000000	9.04000000000000	9.16000000000000	9.21000000000000	9.36000000000000	9.34000000000000	9.28000000000000	9.22000000000000	9.21000000000000	8.88000000000000	8.89000000000000	8.75000000000000	8.78000000000000	8.69000000000000	8.54000000000000	8.69000000000000	8.69000000000000	8.79000000000000	9.20000000000000	9.51000000000000	9.62000000000000	9.95000000000000	10.3800000000000	10.7800000000000	11.0200000000000	11.7800000000000	12.8200000000000	13.0100000000000	13.0600000000000	13.3300000000000	13.8200000000000	13.7400000000000	14.1600000000000	13.4800000000000	14.0600000000000	14.7700000000000	15.6200000000000	15.7400000000000	15.7000000000000	16.2400000000000	17.3100000000000	16.7500000000000	17.0600000000000	16.4500000000000	16.4200000000000	16.7400000000000	16.3500000000000	16.6700000000000	17	17.2000000000000	17.2400000000000	17.2100000000000	17.4800000000000	17.9700000000000	18.1300000000000	18.4800000000000	18.7400000000000	18.5600000000000	18.8900000000000	18.5900000000000	18.4100000000000	17.9700000000000	18.0600000000000	18.0200000000000	18.1600000000000	18.0900000000000	18.4100000000000	18.1800000000000	18.1300000000000	18.2600000000000	18.3000000000000	18.6700000000000	18.3600000000000	19.1100000000000	19.5200000000000	18.8100000000000	18.7200000000000	18.4000000000000	18.0300000000000	18.2500000000000	18.5800000000000	18.5300000000000	18.6700000000000	18.8000000000000	19.3500000000000	20.3400000000000	19.9000000000000	19.6300000000000	19.8800000000000	19.0600000000000	18.9000000000000	18.7500000000000	18.4300000000000	18.4300000000000	18.9100000000000	19.1200000000000	20.5400000000000	21.9500000000000	21.4600000000000	21.3500000000000	21.9700000000000	20.7200000000000	20.9100000000000	20.9300000000000	21.2100000000000	21.9100000000000	21.4200000000000	21.1500000000000	21.3600000000000	21.2000000000000	21.5500000000000	20.9600000000000	21.2600000000000	21.4700000000000	21.2700000000000	21.8900000000000	21.6100000000000	21.5400000000000	21.4200000000000	22.5100000000000	21.8600000000000	21.7800000000000	21.7900000000000	21.3000000000000	21.5300000000000	22.0500000000000	21.4600000000000	20.9900000000000	21.1600000000000	21.0300000000000	20.9300000000000	20.4900000000000	20	19.6200000000000	19.3800000000000	19.1600000000000	19.0600000000000	18.8000000000000	18.6300000000000	18.4100000000000	18.2300000000000	18.1200000000000	18	17.9400000000000	17.7700000000000	17.4800000000000	17.2100000000000	16.9700000000000	16.8700000000000	16.9900000000000	16.9000000000000	16.8100000000000	16.7000000000000	16.5800000000000	16.6000000000000	16.4600000000000	16.1200000000000	16.0700000000000	16.1500000000000	16.0900000000000	15.8500000000000	15.8200000000000	15.6800000000000	15.5500000000000	15.4100000000000	15.3800000000000	15.3900000000000	15.3300000000000	15.0500000000000	15.6600000000000	15.3600000000000	15.1800000000000	14.7600000000000	14.8400000000000	14.5200000000000	14.3400000000000	14.4000000000000	14.6100000000000	14.7900000000000	15.1100000000000	15.3700000000000	15.5700000000000	15.5400000000000	15.4700000000000	15.3800000000000	15.2200000000000	15.0500000000000	14.6200000000000	14.3900000000000	14.2300000000000	14.1700000000000	14.2200000000000	14.1300000000000	14.4100000000000	14.8600000000000	14.7100000000000	14.7100000000000	14.5700000000000	14.9400000000000	15.1000000000000	14.9400000000000	14.2100000000000	13.9700000000000	15.0300000000000	14.9700000000000	14.5200000000000	14.4100000000000	14.3300000000000	14.2200000000000	14	14.0500000000000	13.9100000000000	13.8300000000000	13.7600000000000	13.6000000000000	13.5000000000000	13.5700000000000	13.5700000000000	13.3200000000000	13.3200000000000];
RHout=0.01*[64.7800000000000	64.9700000000000	65.2800000000000	65.8600000000000	66.4900000000000	66.8200000000000	67.4900000000000	68.1000000000000	68.5500000000000	68.6700000000000	69.1500000000000	68.7500000000000	69.2000000000000	69.3700000000000	69.2900000000000	69.1500000000000	69.3500000000000	69.3300000000000	69.4800000000000	69.7700000000000	69.2200000000000	69.9000000000000	70.7800000000000	70.7000000000000	70.5600000000000	70.1900000000000	69.5800000000000	69.8100000000000	69.9500000000000	70.2700000000000	70.3400000000000	70.9600000000000	72.1200000000000	72.5800000000000	73.3500000000000	73.5300000000000	73.6300000000000	74.2100000000000	73.9200000000000	73.6600000000000	74.1800000000000	74.7300000000000	74.7000000000000	74.3000000000000	74.3800000000000	74.3500000000000	74.8400000000000	75.2900000000000	75.7700000000000	74.1200000000000	73.3300000000000	72.8500000000000	73.1900000000000	74.7700000000000	76.5200000000000	76.7100000000000	76.7300000000000	76.8800000000000	77.0700000000000	77.2900000000000	78.7300000000000	78.1300000000000	77.5100000000000	76.9600000000000	76.2100000000000	76.1200000000000	75.1800000000000	74.4000000000000	75.9700000000000	77.8300000000000	78.8500000000000	78.1800000000000	78	77.4100000000000	77.1800000000000	77.7700000000000	79.0700000000000	78.2700000000000	78.6600000000000	78.8600000000000	79.4300000000000	79.3500000000000	79	79.2900000000000	79.5500000000000	79.2800000000000	78.9800000000000	77.6800000000000	76.2900000000000	75.8100000000000	75.1700000000000	73.6800000000000	71.7200000000000	71.9000000000000	68.9600000000000	65.7300000000000	63.5100000000000	63.4700000000000	62.6000000000000	60.4500000000000	62.0300000000000	60.1300000000000	62.5400000000000	62.1000000000000	60.3800000000000	58.2200000000000	58.3200000000000	58.3200000000000	56.7200000000000	53.0700000000000	56.8500000000000	55.2300000000000	58.6700000000000	57.8800000000000	61.5700000000000	57.6200000000000	56.7500000000000	55.7200000000000	55.6100000000000	55.5400000000000	55.7200000000000	56.4900000000000	53.7700000000000	54.3700000000000	52.8100000000000	52.4200000000000	52.0700000000000	51.7600000000000	51.0900000000000	50.4400000000000	52.1000000000000	52.0800000000000	51.6500000000000	50.9000000000000	51.7300000000000	50.5700000000000	51.4200000000000	50.7100000000000	52.7100000000000	50.5200000000000	49.3300000000000	49.4300000000000	49.7800000000000	47.1100000000000	50.6400000000000	49.2700000000000	50.2000000000000	50.0700000000000	49.0400000000000	48.3900000000000	48.5300000000000	47.5200000000000	47.1600000000000	46.1300000000000	44.9200000000000	44.3000000000000	44.8500000000000	43.9200000000000	46.1200000000000	45.6500000000000	45.6300000000000	45.3400000000000	45.9100000000000	44.9600000000000	44.1700000000000	41.5600000000000	38.1200000000000	40.8700000000000	38.3400000000000	37.4700000000000	40.8300000000000	40.6700000000000	38.6700000000000	38.3500000000000	36.5800000000000	37.0100000000000	38.8400000000000	38.4900000000000	37.2200000000000	36.0600000000000	37.8100000000000	35.7300000000000	35.5400000000000	36.6300000000000	37.4400000000000	35.4500000000000	36.3900000000000	35.9400000000000	37.2700000000000	35.3600000000000	34.3200000000000	36.3100000000000	35.5100000000000	35.5100000000000	34.2500000000000	35.3700000000000	40.4100000000000	36.1200000000000	38.1400000000000	37.0700000000000	38.4700000000000	40.7500000000000	38.6000000000000	42.1300000000000	39.1400000000000	40.6800000000000	43.2200000000000	40.8900000000000	42.2100000000000	42.3800000000000	42.7500000000000	42.6800000000000	43.6900000000000	44.1200000000000	45.2800000000000	46.7000000000000	49.1200000000000	48.5400000000000	46.9300000000000	46.8300000000000	47.1800000000000	47.9000000000000	47.5700000000000	47.8500000000000	48.9500000000000	49.4400000000000	49.2500000000000	49.4700000000000	52.1000000000000	50.0800000000000	49.2800000000000	49.7500000000000	49.8300000000000	50.2100000000000	50.3900000000000	50.1500000000000	50.4800000000000	52.9600000000000	48.3200000000000	48.8100000000000	49.6500000000000	51.1100000000000	50.6300000000000	52.9500000000000	53.3800000000000	52.9600000000000	51.8300000000000	49.9200000000000	49.3600000000000	46.9400000000000	46.7200000000000	47.3700000000000	47.3900000000000	46.9700000000000	47.1100000000000	48.9200000000000	50.9600000000000	52.2000000000000	52.3900000000000	52.2900000000000	52.0500000000000	52.7900000000000	48.9200000000000	49.2100000000000	48.5100000000000	49.2500000000000	49.2100000000000	48.4500000000000	47.6300000000000	47.9200000000000	50.5200000000000	50.6200000000000	46.8700000000000	46.6700000000000	48.0500000000000	47.0100000000000	45.9400000000000	45.2000000000000	44.6400000000000	42.6400000000000	43.0200000000000	41.7500000000000	41.2100000000000	43.1100000000000	41.2400000000000	40.9600000000000	40.3000000000000	40.9100000000000	39.6300000000000];
Hout=5.5638*exp(0.0572*Tout).*RHout;                          
Cout=407*1977*10^-6*ones(1,24*3600/N);
Qsun=0.7*[0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0.00586717000000000	2.11218000000000	5.56208000000000	10.3849000000000	17.2788000000000	26.3847000000000	36.5701000000000	47.5417000000000	59.1646000000000	71.5795000000000	85.2969000000000	98.9499000000000	112.920000000000	126.226000000000	138.940000000000	157.733000000000	171.093000000000	185.714000000000	200.364000000000	216.352000000000	231.390000000000	250.423000000000	264.938000000000	281.362000000000	297.883000000000	311.314000000000	322.839000000000	337.394000000000	351.108000000000	363.552000000000	379.685000000000	392.588000000000	406.611000000000	420.252000000000	432.037000000000	441.865000000000	457.030000000000	469.206000000000	480.729000000000	490.706000000000	509.649000000000	516.515000000000	539.208000000000	537.888000000000	576.048000000000	310.576000000000	409.777000000000	312.243000000000	528.348000000000	542.822000000000	582.273000000000	577.419000000000	571.592000000000	585.647000000000	635.334000000000	627.638000000000	615.130000000000	613.281000000000	641.526000000000	694.130000000000	799.760000000000	877	520.229000000000	380.334000000000	267.035000000000	292.759000000000	298.882000000000	361.945000000000	275.761000000000	248.312000000000	529.464000000000	617.799000000000	593.940000000000	318.796000000000	280.737000000000	262.830000000000	192.206000000000	156.645000000000	139.565000000000	143.696000000000	190.723000000000	319.618000000000	725.721000000000	668.651000000000	627.324000000000	584.158000000000	554.580000000000	547.900000000000	527.407000000000	503.506000000000	493.121000000000	496.558000000000	543.802000000000	467.102000000000	424.832000000000	424.593000000000	412.727000000000	403.723000000000	404.212000000000	390.247000000000	390.088000000000	416.451000000000	391.078000000000	354.294000000000	334.510000000000	304.244000000000	284.445000000000	260.519000000000	240.145000000000	221.137000000000	202.752000000000	182.577000000000	166.432000000000	150.522000000000	137.324000000000	121.228000000000	106.194000000000	88.4950000000000	54.0424000000000	28.2238000000000	22.5264000000000	17.8998000000000	14.4091000000000	11.2814000000000	10.0221000000000	5.23691000000000	2.14405000000000	0.0175753000000000	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0];
Qlamp=[110*ones(1,3600/N),110*ones(1,3600/N),110*ones(1,3600/N),110*ones(1,3600/N),110*ones(1,3600/N),110*ones(1,3600/N),0*ones(1,3600/N),0*ones(1,3600/N),0*ones(1,3600/N),0*ones(1,3600/N),0*ones(1,3600/N),0*ones(1,3600/N),...
0*ones(1,3600/N),0*ones(1,3600/N),0*ones(1,3600/N),0*ones(1,3600/N),0*ones(1,3600/N),0*ones(1,3600/N),110*ones(1,3600/N),110*ones(1,3600/N),110*ones(1,3600/N),110*ones(1,3600/N),110*ones(1,3600/N),110*ones(1,3600/N)] ;

Tout=repelem(Tout,5);
Hout=repelem(Hout,5);
Qsun=repelem(Qsun,5);


for k=i:i+Np-1                    

    Qcov(k)=kcov*(T(k)-Tout(k));                                             
    Qvent(k)=U2(k-i+1)*ru*Cair*(T(k)-Tout(k));

    Rn(k)=0.86*(1-exp(-0.7*LAI))*(Qsun(k)+Qlamp(k));                        
    rs(k)=(82+570*exp(-gamma*Rn(k)/LAI))*(1+0.023*(T(k)-20)^2);
    epsi(k)=0.7584*exp(0.0518*T(k));
    ge(k)=2*LAI/((1+epsi(k))*rb+rs(k));
    Hsat(k)=5.5638*exp(0.0572*T(k));
    Hcrop(k)=Hsat(k)+epsi(k)*rb/(2*LAI)*Rn(k)/L;

    Qtrans(k)=ge(k)*L*(Hcrop(k)-H(k));


    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%  
    pgc=1.8*10^-3;
    Tcov(k)=(T(k)+2*Tout(k))/3;
    if T(k)>Tcov(k)
    
        gc(k)=pgc*(T(k)-Tcov(k))^(1/3);
    else
        gc(k)=0;
        
    end
%     gc(k)=max(0,pgc*(T(k)-Tcov(k))^(1/3));

    Hcov(k)=gc(k)*(0.2522*exp(0.0458*T(k))*(T(k)-Tout(k))-(Hsat(k)-H(k)));  
    Htrans(k)=ge(k)*(Hcrop(k)-H(k));                                             
    Hvent(k)=U2(k-i+1)*(H(k)-Hout(k));                                           

    % H(k+1)=H(k)+1/h*(u2+Htrans-Hcov-Hvent);

    %%%%%%%%%%%%%%%%%%%   
    Cass(k)=2.2*10^(-3)/(1+0.230/C(k))*(1-exp(-0.0015*(Qsun(k)+Qlamp(k))));
    Cvent(k)=U2(k-i+1)*(C(k)-Cout(k));

    % C(k+1)=C(k)+1/h*(u3-Cass-Cvent);


    T(k+1)=T(k)+N/Ccap*(U1(k-i+1)-Qtrans(k)-Qcov(k)-Qvent(k)+Qsun(k)+Qlamp(k));  
    H(k+1)=H(k)+N/h*(Htrans(k)-Hcov(k)-Hvent(k));
    C(k+1)=C(k)+N/h*(U3(k-i+1)-Cass(k)-Cvent(k));
    RH(k+1)=H(k+1)/(5.5638*exp(0.0572*T(k+1)));
    
end
T=T(i+1:i+Np);
% H=H(i:i+Np);
C=C(i+1:i+Np);
RH=RH(i+1:i+Np);

end